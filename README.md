# 富邦雙頻道直播 PWA

## iPhone PWA Twitch 登入狀態持久化解決方案

### 問題描述
在iPhone上安裝PWA到主畫面後，登入Twitch後關閉程式再重新開啟時，登入狀態沒有被保存，需要重新登入。

### 解決方案

#### 1. 背景狀態管理
- 使用 `IPhonePWAuthManager` 類在背景管理登入狀態
- 結合 `localStorage` 和 `sessionStorage` 來保存登入狀態
- 智能檢測iframe中的登入狀態
- 定期檢查認證過期時間

#### 2. 播放器URL優化
- 在播放器URL中添加iPhone PWA特定參數
- 添加認證token和時間戳避免快取問題
- 優化聊天室URL生成

#### 3. 無UI設計
- 不添加任何UI控制器或按鈕
- 用戶直接通過Twitch嵌入式播放器進行登入
- 完全背景運行，無縫用戶體驗

### 使用方法

#### 登入Twitch
1. 直接通過Twitch嵌入式播放器進行登入
2. 系統會自動檢測並保存登入狀態
3. PWA會在背景自動管理登入狀態
4. 無需額外的UI操作

#### 登出Twitch
1. 通過Twitch播放器進行登出
2. 系統會自動清除本地保存的登入狀態
3. 播放器會保持當前狀態，不會重新載入

### 技術實現

#### 主要功能
- `IPhonePWAuthManager` 類：背景管理Twitch登入狀態
- 智能狀態檢測：結合多種存儲方式判斷登入狀態
- 自動恢復檢測：當PWA從背景恢復時自動檢查狀態
- 播放器URL優化：添加iPhone PWA相關參數
- 無重新載入：避免播放器閃爍問題

#### 存儲機制
- `localStorage`: 保存認證token和過期時間
- `sessionStorage`: 保存當前會話狀態
- 24小時有效期：登入狀態在24小時內有效

#### iPhone PWA 特定優化
- 檢測iOS設備和PWA模式
- 添加iOS特定的meta標籤
- 優化觸控體驗
- 防止頁面縮放和滾動

### 兼容性
- 專門針對iPhone PWA優化
- 支持iOS Safari PWA
- 支持Android Chrome PWA
- 支持桌面瀏覽器

### 注意事項

1. **無UI干擾**：完全背景運行，不影響用戶體驗
2. **智能檢測**：自動檢測播放器中的登入狀態
3. **避免閃爍**：不重新載入播放器，保持流暢體驗
4. **會話管理**：登入狀態基於本地存儲，清除瀏覽器數據會丟失狀態

### 版本信息
- 當前版本：v1.9.2
- 更新時間：2024年
- 支持平台：iOS PWA (主要), Android, Desktop
